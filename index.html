<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LCB ID Translations</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preload" href="assets/mouse_on.cur" as="image">
  <link rel="preload" href="assets/UI_Hover.wav" as="audio">
  <link rel="preload" href="assets/UI_Click.wav" as="audio">
</head>
<body>
<!-- Background elements -->
<div class="body-bg" id="current-bg"></div>
<div class="body-bg" id="new-bg"></div>

<a href="https://www.youtube.com/@NotherWael" target="_blank">
  <img src="assets/channels4_profile.jpg" alt="YouTube Profile" id="youtube-profile">
</a>

<a href="https://github.com/NotherWael/LCB-TLS" target="_blank" class="github-link">
  Link To Github Repo
</a>

<!-- Back Button -->
<button id="back-button" style="display:none;">
  <img src="assets/Back.png" alt="Back" />
</button>

<div class="overlay">
  <div class="content mikodacs-text">
    <h1>LCB Identities - Untranslated Voicelines Translated to English</h1>
    <p>Updated 21th April - Remember Translations can always be wrong!</p>

    <!-- Main Image Gallery -->
    <div class="image-gallery">
      <a href="pages/Yi_Sang.html" data-background="assets/Yi_Sang/LCB_YiSang.png">
        <img src="assets/Yi_Sang_ID_Photo_1.png" alt="Yi Sang">
      </a>
      <a href="pages/Faust.html" data-background="assets/bg/faust_main.jpg">
        <img src="assets/Faust_ID_Photo_1.png" alt="Faust">
      </a>
      <a href="pages/Don_Quixote.html" data-background="assets/bg/don_quixote_main.jpg">
        <img src="assets/Don_Quixote_ID_Photo_1.png" alt="Don Quixote">
      </a>
      <a href="pages/Ryōshū.html" data-background="assets/bg/ryoshu_main.jpg">
        <img src="assets/Ryōshū_ID_Photo_1.png" alt="Ryōshū">
      </a>
      <a href="pages/Meursault.html" data-background="assets/bg/meursault_main.jpg">
        <img src="assets/Meursault_ID_Photo_1.png" alt="Meursault">
      </a>
      <a href="pages/Hong_Lu.html" data-background="assets/bg/hong_lu_main.jpg">
        <img src="assets/Hong_Lu_ID_Photo_1.png" alt="Hong Lu">
      </a>
      <a href="pages/Heathcliff.html" data-background="assets/bg/heathcliff_main.jpg">
        <img src="assets/Heathcliff_ID_Photo_1.png" alt="Heathcliff">
      </a>
      <a href="pages/Ishmael.html" data-background="assets/bg/ishmael_main.jpg">
        <img src="assets/Ishmael_ID_Photo_1.png" alt="Ishmael">
      </a>
      <a href="pages/Rodion.html" data-background="assets/bg/rodion_main.jpg">
        <img src="assets/Rodion_ID_Photo_1.png" alt="Rodion">
      </a>
      <a href="pages/Sinclair.html" data-background="assets/bg/sinclair_main.jpg">
        <img src="assets/Sinclair_ID_Photo_1.png" alt="Sinclair">
      </a>
      <a href="pages/Outis.html" data-background="assets/bg/outis_main.jpg">
        <img src="assets/Outis_ID_Photo_1.png" alt="Outis">
      </a>
      <a href="pages/Gregor.html" data-background="assets/bg/gregor_main.jpg">
        <img src="assets/Gregor_ID_Photo_1.png" alt="Gregor">
      </a>
    </div>

    <!-- Dynamic content -->
    <div id="dynamic-content" class="dynamic-content"></div>
  </div>
</div>

<!-- Sounds -->
<audio src="assets/UI_Hover.wav" preload="auto" style="display:none;"></audio>
<audio src="assets/UI_Click.wav" preload="auto" style="display:none;"></audio>

<script>
  const hoverSoundTemplate = new Audio('assets/UI_Hover.wav');
  hoverSoundTemplate.volume = 0.7;
  const clickSound = new Audio('assets/UI_Click.wav');
  clickSound.volume = 0.8;
  let canClickPlay = true;
  const cache = new Map();
  let currentCharacterGallery = null;
  let backButtonHandler = null;

  const gallery = document.querySelector('.image-gallery');
  const galleryLinks = document.querySelectorAll('.image-gallery a');
  const dynamicContent = document.getElementById('dynamic-content');
  const backButton = document.getElementById('back-button');

  // Restored hover sounds for back button
  backButton.addEventListener('mouseenter', () => {
    const hoverSound = hoverSoundTemplate.cloneNode();
    hoverSound.play().catch((e) => {
      console.warn("Hover sound failed to play:", e);
    });
  });

  // Restored main gallery hover sounds
  galleryLinks.forEach(link => {
    const img = link.querySelector('img');
    img.addEventListener('mouseenter', () => {
      const hoverSound = hoverSoundTemplate.cloneNode();
      hoverSound.play().catch(() => {});
    });
  });

let isTransitioning = false;

let currentTransition = null;

function changeBackground(bgUrl) {
  const currentBg = document.getElementById('current-bg');
  const newBg = document.getElementById('new-bg');

  // Cancel any ongoing transition
  if (currentTransition) {
    clearTimeout(currentTransition);
    newBg.style.display = 'none';
    newBg.style.opacity = '0';
    currentBg.style.opacity = '1';
  }

  // Don't transition if same background
  if (currentBg.style.backgroundImage === `url("${bgUrl}")`) return;

  // Set up new background
  newBg.style.backgroundImage = `url(${bgUrl})`;
  newBg.style.display = 'block';
  newBg.style.opacity = '0';
  
  // Force reflow
  void newBg.offsetHeight;

  // Start transition
  newBg.style.opacity = '1';
  currentBg.style.opacity = '0';

  // Complete transition after 1s
  currentTransition = setTimeout(() => {
    currentBg.style.backgroundImage = newBg.style.backgroundImage;
    newBg.style.display = 'none';
    newBg.style.opacity = '0';
    currentBg.style.opacity = '1';
    currentTransition = null;
  }, 1000);
}

  galleryLinks.forEach(link => {
    const img = link.querySelector('img');
    img.addEventListener('click', (e) => {
      e.preventDefault();
      if (canClickPlay) {
        clickSound.currentTime = 0;
        clickSound.play().catch(() => {});
        canClickPlay = false;
        setTimeout(() => { canClickPlay = true; }, 300);
      }

      const bgImage = link.dataset.background;
      if (bgImage) changeBackground(bgImage);

      const targetUrl = link.getAttribute('href');
      if (cache.has(targetUrl)) {
        showContent(cache.get(targetUrl));
      } else {
        fetch(targetUrl)
          .then(response => response.text())
          .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const content = doc.body.innerHTML;
            cache.set(targetUrl, content);
            showContent(content);
          })
          .catch(err => {
            dynamicContent.innerHTML = "<p>Error loading content.</p>";
            console.error(err);
          });
      }
    });
  });

  dynamicContent.addEventListener('click', function(e) {
    const galleryImg = e.target.closest('.character-gallery img');
    const bgLink = e.target.closest('[data-background]');
    
    if (bgLink) {
      changeBackground(bgLink.dataset.background);
    }
    
    if (galleryImg) {
      e.preventDefault();
      showVoicelineDetail(galleryImg);
    }
  });

  function showVoicelineDetail(imgElement) {
    // Get the parent <a> element containing the data attributes
    const parentLink = imgElement.closest('.character-voice');
    
    // Split data attributes with error handling
    const voicelines = (parentLink.dataset.voiceline || "").split('|').map(v => v.trim());
    const translations = (parentLink.dataset.translation || "").split('|').map(v => v.trim());
    const audios = (parentLink.dataset.audio || "").split('|').map(v => v.trim());
    const notes = (parentLink.dataset.notes || "").split('|').map(v => v.trim());

    // Create table rows with validation
    const maxEntries = Math.max(voicelines.length, translations.length, audios.length, notes.length);
    let rows = [];
    
    for (let i = 0; i < maxEntries; i++) {
      rows.push(`
        <tr>
          <td>${voicelines[i] || '—'}</td>
          <td>${translations[i] || '—'}</td>
          <td>${audios[i] ? `<audio controls><source src="${audios[i]}" type="audio/wav"></audio>` : '—'}</td>
          <td>${notes[i] || '—'}</td>
        </tr>
      `);
    }

    const detailHTML = `
      <div class="voiceline-detail">
        <img src="${imgElement.src}" alt="${imgElement.alt}" class="detail-image">
        <div class="spreadsheet">
          <table>
            <thead>
              <tr>
                <th>Voiceline</th>
                <th>Translation</th>
                <th>Audio</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              ${rows.join('')}
            </tbody>
          </table>
        </div>
      </div>
    `;
    dynamicContent.innerHTML = detailHTML;
    backButtonHandler = returnToCharacterGallery;
  }

  function returnToCharacterGallery() {
    dynamicContent.innerHTML = currentCharacterGallery;
    backButtonHandler = returnToMainGallery;
  }

function returnToMainGallery() {
  dynamicContent.innerHTML = '';
  dynamicContent.classList.remove('visible');
  gallery.style.display = 'grid';
  backButton.style.display = 'none';
  changeBackground('assets/background.png'); // Reset to main background
}

  backButton.addEventListener('click', () => {
    clickSound.currentTime = 0;
    clickSound.play().catch((e) => {
      console.warn("Click sound failed to play:", e);
    });

    if (backButtonHandler) {
      backButtonHandler();
    } else {
      returnToMainGallery();
    }
  });

  function showContent(html) {
    gallery.style.display = 'none';
    dynamicContent.innerHTML = html;
    dynamicContent.classList.add('visible');
    backButton.style.display = 'block';

    const characterGallery = dynamicContent.querySelector('.character-gallery');
    if (characterGallery) {
      currentCharacterGallery = dynamicContent.innerHTML;
      backButtonHandler = returnToMainGallery;
    }
  }
</script>
</body>
</html>